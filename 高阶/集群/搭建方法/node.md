# **内存磁盘的监控**

可以选择可视化的web

![image-20220227185450229](F:\code\案列\中间件分布式框架\消息队列RabbitMQ\高阶\集群\搭建方法\image-20220227185450229.png)

![image-20220227185352787](F:\code\案列\中间件分布式框架\消息队列RabbitMQ\高阶\集群\搭建方法\image-20220227185352787.png)

一旦爆红，链接全部被挂起（默认总内存的0.4）

![image-20220227185634245](F:\code\案列\中间件分布式框架\消息队列RabbitMQ\高阶\集群\搭建方法\image-20220227185634245.png)

![image-20220227185725465](F:\code\案列\中间件分布式框架\消息队列RabbitMQ\高阶\集群\搭建方法\image-20220227185725465.png)

修改配置文件，也可以修改阈值大小，取值范围为0.4~0.7之间

https://www.rabbitmq.com/configure.html

![image-20220227190108693](F:\code\案列\中间件分布式框架\消息队列RabbitMQ\高阶\集群\搭建方法\image-20220227190108693.png)

![image-20220227190230230](F:\code\案列\中间件分布式框架\消息队列RabbitMQ\高阶\集群\搭建方法\image-20220227190230230.png)

![image-20220227190308078](F:\code\案列\中间件分布式框架\消息队列RabbitMQ\高阶\集群\搭建方法\image-20220227190308078.png)

# 集群搭建

安装rabbitmq

https://www.rabbitmq.com/install-debian.html

![image-20220227190615980](F:\code\案列\中间件分布式框架\消息队列RabbitMQ\高阶\集群\搭建方法\image-20220227190615980.png)

![image-20220227190939011](F:\code\案列\中间件分布式框架\消息队列RabbitMQ\高阶\集群\搭建方法\image-20220227190939011.png)

![image-20220227191051002](F:\code\案列\中间件分布式框架\消息队列RabbitMQ\高阶\集群\搭建方法\image-20220227191051002.png)

![image-20220227191118112](F:\code\案列\中间件分布式框架\消息队列RabbitMQ\高阶\集群\搭建方法\image-20220227191118112.png)

![image-20220227191240685](F:\code\案列\中间件分布式框架\消息队列RabbitMQ\高阶\集群\搭建方法\image-20220227191240685.png)

![image-20220227191255217](F:\code\案列\中间件分布式框架\消息队列RabbitMQ\高阶\集群\搭建方法\image-20220227191255217.png)

```
一般来说，构造集群最好时三个。一主多备的状态
sudo rabbitmqctl -n rabbit-2 join_cluster rabbit-1@"server-node"
```

![image-20220227191447974](F:\code\案列\中间件分布式框架\消息队列RabbitMQ\高阶\集群\搭建方法\image-20220227191447974.png)

![image-20220227192136335](F:\code\案列\中间件分布式框架\消息队列RabbitMQ\高阶\集群\搭建方法\image-20220227192136335.png)

★记得配置安全组策略,允许端口访问

集群配置成功后，可以创建一个exchange+queue，并绑定。用以测试

这里从节点已挂。

![image-20220227192853863](F:\code\案列\中间件分布式框架\消息队列RabbitMQ\高阶\集群\搭建方法\image-20220227192853863.png)

主节点很重要，一旦挂了，从节点也没用了。

集群应用方式：

### **1.单机部署方式，记得改端口**

### **2.多机部署方式，记得copy cookie**



![image-20220227193330907](F:\code\案列\中间件分布式框架\消息队列RabbitMQ\高阶\集群\搭建方法\image-20220227193330907.png)

# 分布式搭建

这里就是很值得玩的地方了。

## 2PC 分布式事务处理，需要数据厂商支持

![image-20220227195816086](F:\code\案列\中间件分布式框架\消息队列RabbitMQ\高阶\集群\搭建方法\image-20220227195816086.png)

![image-20220227195758951](F:\code\案列\中间件分布式框架\消息队列RabbitMQ\高阶\集群\搭建方法\image-20220227195758951.png)

## 补偿事务TCC

![image-20220227195827919](F:\code\案列\中间件分布式框架\消息队列RabbitMQ\高阶\集群\搭建方法\image-20220227195827919.png)

## 本地消息表

![image-20220227200032022](F:\code\案列\中间件分布式框架\消息队列RabbitMQ\高阶\集群\搭建方法\image-20220227200032022.png)

## 基于mq事务的消息异步

![image-20220227200125020](F:\code\案列\中间件分布式框架\消息队列RabbitMQ\高阶\集群\搭建方法\image-20220227200125020.png)

![image-20220227200146196](F:\code\案列\中间件分布式框架\消息队列RabbitMQ\高阶\集群\搭建方法\image-20220227200146196.png)

![image-20220227200219592](F:\code\案列\中间件分布式框架\消息队列RabbitMQ\高阶\集群\搭建方法\image-20220227200219592.png)

ACID事务原则，整体成功or整体失败。

MQ消息中间件：

1.连接两个业务之间数据一致性

2.代码内部解耦

3.消息集群让业务更健硕















